# Devcontainerの使い分け方

## はじめに

このドキュメントでは、マルチサービス構成のプロジェクトにおけるDevcontainer（開発コンテナ）の設定と使い分け方について説明します。フロントエンドとバックエンドのような複数のサービスを持つプロジェクトでは、開発環境の構成方法によって効率と使いやすさが大きく変わります。

## 目次

- [二つのアプローチ](#二つのアプローチ)
  - [アプローチA：プロジェクトルートに.devcontainerを配置](#アプローチaプロジェクトルートにdevcontainerを配置)
  - [アプローチB：各ディレクトリに.devcontainerを配置](#アプローチb各ディレクトリにdevcontainerを配置)
- [コンテナ環境の理解](#コンテナ環境の理解)
- [当プロジェクトでの選択：アプローチB](#当プロジェクトでの選択アプローチb)
- [環境へのアクセス方法](#環境へのアクセス方法)
  - [共通ドキュメントへのアクセス](#共通ドキュメントへのアクセス)
  - [実際の使い方](#実際の使い方)
- [注意点](#注意点)

## 二つのアプローチ

Devcontainerを使った開発環境の構成には、主に2つのアプローチがあります：

### アプローチA：プロジェクトルートに.devcontainerを配置

**配置構成**:
```
mailcraft-ai/
├── .devcontainer/
│   ├── devcontainer.json (「service: frontend」を指定)
│   └── docker-compose.yml (frontendとbackendの両方を定義)
├── frontend/
└── backend/
```

**ワークフロー**:
1. VSCodeでプロジェクトルート (`mailcraft-ai/`) を開く
2. devcontainerを起動すると、devcontainer.jsonで指定されたサービス (frontend) に接続
3. **別のサービス (backend) に切り替えたい場合**:
   - devcontainerを一度閉じる
   - VSCodeの設定から別のサービスを選択して再度開く（serviceをfrontendからbackendへ変更必要）

**特徴**:
- プロジェクト全体を1つのVSCodeウィンドウで見ることができる
- サービス間の切り替えに時間がかかる
- 一度に1つのサービス内でしか作業できない

### アプローチB：各ディレクトリに.devcontainerを配置

**配置構成**:
```
mailcraft-ai/
├── docker-compose.yml (frontendとbackendの両方を定義)
├── frontend/
│   └── .devcontainer/
│       └── devcontainer.json (「service: frontend」を指定)
└── backend/
    └── .devcontainer/
        └── devcontainer.json (「service: backend」を指定)
```

**ワークフロー**:
1. フロントエンド開発: VSCodeで `mailcraft-ai/frontend/` を開く
2. バックエンド開発: 別のVSCodeウィンドウで `mailcraft-ai/backend/` を開く
3. 両方を同時に開発: 2つのVSCodeウィンドウを並べて作業

**特徴**:
- 明確に分離された開発環境
- 同時に両方の環境で作業ができる（別々のウィンドウで）
- 切り替えが高速（ウィンドウ間の切り替えだけ）
- プロジェクト全体を1つのビューで見るのが難しい

## コンテナ環境の理解

どちらのアプローチでも、**コンテナ自体は同じ**です:
- frontendコンテナとbackendコンテナの2つが存在
- 両方とも同じdocker-compose.ymlで定義される
- 両方のコンテナは同時に実行される

**違いは開発環境（VSCode）からどうアクセスするか**です。

## 当プロジェクトでの選択：アプローチB

当プロジェクトでは、アプローチBを採用しています。その理由は：

1. **開発効率**: フロントエンドとバックエンドの間を頻繁に行き来する場合、アプローチBの方が効率的
2. **同時開発**: 両方のサービスを同時に開発・テストする必要がある場合に適している
3. **コンテキスト切り替えの最小化**: 各環境に特化したVSCodeウィンドウを保持できる

## 環境へのアクセス方法

### 共通ドキュメントへのアクセス

当プロジェクトでは、共通のドキュメントやファイルにアクセスするための工夫として：

1. プロジェクトルートのdocker-compose.ymlで以下のようにボリュームをマウント：
   ```yaml
   volumes:
     - .:/workspace:cached
   ```

2. フロントエンドディレクトリ内に共通ドキュメントへのシンボリックリンクを作成：
   ```bash
   cd frontend && ln -s ../docs docs
   ```

これにより、各開発環境からもプロジェクト全体のドキュメントにアクセスできます。

### 実際の使い方

1. **フロントエンド開発**:
   ```bash
   code frontend/
   ```
   VSCodeが開いたら、「Dev Containers: Reopen in Container」を選択

2. **バックエンド開発（将来的に）**:
   ```bash
   code backend/
   ```
   VSCodeが開いたら、「Dev Containers: Reopen in Container」を選択

3. **同時開発**:
   - 両方のVSCodeウィンドウを並べて配置
   - 各ウィンドウ内で開発を進める

## 注意点

1. **初回起動時**:
   - 最初のdevcontainer起動時にすべてのサービスが起動される
   - 2つ目以降のVSCodeウィンドウでは既存のコンテナを再利用するため起動が早い

2. **GitとVSCodeの統合**:
   - 各VSCodeウィンドウはGitリポジトリを認識する
   - プルリクエストやブランチ操作は各ウィンドウから可能

3. **デバッグ設定**:
   - 各サービスに特化したデバッグ設定が可能
   - launch.jsonなどの設定ファイルを各サービスディレクトリに配置

このアプローチを採用することで、開発体験の向上と開発効率の最大化を図っています。 