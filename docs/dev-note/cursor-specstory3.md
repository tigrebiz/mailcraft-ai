<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" class="logo" width="120"/>

# 

---

# Cursor拡張機能SpecStory完全ガイド

SpecStoryは、Cursorエディタで行われるAIとの対話を自動的に記録し、効率的に活用するための画期的な拡張機能です。この記事では、SpecStoryの基本機能から応用的な活用法まで、開発者が知っておくべき情報を網羅的にまとめました。

## SpecStoryの概要と主要機能

SpecStoryは、Cursor（Visual Studio Codeの派生エディタ）専用の拡張機能で、AIアシスタントとの対話を効率的に記録・活用するために開発されました。「あの時のいい提案どこいったっけ？」という開発者の悩みを解決し、AIとの会話を貴重な資産として蓄積することができます。

### AIチャット履歴の自動保存機能

SpecStoryの中核となる機能は、AIとのチャット履歴を自動的に保存する機能です。この機能により、開発者はCursorエディタでAIアシスタントと対話するたびに、その内容が自動的にMarkdown形式で`.specstory`ディレクトリに保存されます。

保存される情報には、以下のようなものが含まれます：

- 開発者からAIへの質問内容
- AIからの回答全文（コードブロックを含む）
- 日時情報
- セッションID

各会話は個別のMarkdownファイルとして保存されるため、後から特定の会話を見つけやすくなっています。これにより、数週間前や数か月前に行ったAIとの重要な対話も、消失することなく参照できるようになります。

### Composerセッション追跡機能

単なるチャットの記録だけではなく、Cursor独自の「Composer」機能（コード自動生成や差分提案など）の履歴も追跡できる点も重要な特徴です。

Composerセッションでは、以下のような情報が記録されます：

- 元のコード状態
- 指示内容
- 生成されたコードや差分
- 適用された変更の詳細

このデータがあれば、「なぜこのコードがこのように実装されたのか」「どのような指示からこの実装が生まれたのか」を後から追跡できるようになります。これはコードレビューや、新しいチームメンバーへの知識移転において非常に有用です。

### 検索性の向上

Markdownとして履歴が保存されるため、プロジェクト内検索機能（Ctrl+Shift+FやCmd+Shift+F）や外部ツールを用いた全文検索が簡単に行えます。

これにより、以下のようなシナリオが可能になります：

- 特定のライブラリやフレームワークに関する過去の質問と回答を検索
- エラーメッセージや特定の問題に関する過去の解決策をキーワード検索
- 特定の機能実装に関する過去の議論を見つける

ログが蓄積されるほど、過去のやり取りが重要なナレッジベースとして機能するようになり、同じ質問を何度もAIに尋ねる必要がなくなります。

### ローカル保存によるセキュリティ確保

AIとのやり取りデータは`.specstory`ディレクトリ配下にローカル保存されます。クラウドに自動アップロードされないため、企業やチームの機密情報に配慮しながら開発を進めることができます。

これは、以下のようなケースで特に重要です：

- 企業の機密コードやビジネスロジックが含まれる開発
- 個人情報や機密データを取り扱うプロジェクト
- セキュリティ要件が厳しい環境での開発作業


### 共有機能

SpecStoryには、AIとの会話履歴を他のユーザーと共有するための機能が組み込まれています。この機能を利用するには、コマンドパレット（Windows/LinuxではCtrl+Shift+P、MacではCmd+Shift+P）から「SpecStory: Share Conversation」または類似のコマンドを選択します。

share.specstory.comプラットフォームを通じて、以下のような特徴を活かした共有が可能です：

- **Markdownフォーマットの保持**: AIとの会話がMarkdown形式のまま共有され、コードブロックや構文ハイライトなどが正確に表示されます。
- **双方向のやり取りの表示**: 質問と回答が時系列順に表示され、会話の流れが把握しやすくなっています。
- **アクセス制御機能**: 共有内容へのアクセスを制限するオプションがあり、セキュリティを確保しながら必要な人とだけ共有できます。
- **埋め込み機能**: 生成されたリンクをブログやドキュメントに埋め込むことが可能で、技術記事やチュートリアルの作成に役立ちます。

チーム開発においては、以下のような場面で特に有用です：

- 複雑な問題解決の過程をチームメンバーと共有する
- 新規参加者へのオンボーディング資料として活用する
- プロジェクトの技術的な決定の背景と理由を記録・共有する
- コードレビューでの議論の補助資料として使用する


### 実験的機能：チャット履歴からCursorルールを自動生成

SpecStoryのもう一つの注目すべき機能は、AIとのチャット履歴を分析してCursorのプロジェクトルールを自動生成する実験的な機能です。これにより、繰り返し発生するパターンや重要なコンテキスト情報を自動的にルール化することができます。

この機能は以下のようなプロセスで動作します：

1. **チャット履歴の分析**: `.specstory`ディレクトリに保存されたAIとの会話履歴を分析し、頻出するパターンや指示、コンテキスト情報を抽出します。
2. **ルール候補の生成**: 分析結果に基づいて、Project Rulesまたは`.cursorrules`ファイルとして適用可能なルール候補を自動生成します。
3. **ユーザーによる確認と編集**: 生成されたルール候補はユーザーに提示され、確認・編集した上で実際のルールとして適用するかどうかを決定できます。

この機能で生成される可能性のあるルールには以下のようなものがあります：

- **コーディング規約**: チャット内で繰り返し言及された命名規則やフォーマットルールなど。
- **プロジェクト固有の指示**: 特定のライブラリの使用方法やアーキテクチャに関する制約など。
- **エラー処理パターン**: よく議論されるエラー処理やバリデーションのアプローチなど。
- **ドキュメント化ルール**: コメントの書き方やドキュメント生成に関するガイドラインなど。

この機能は実験的な段階にあるため、以下の点に注意が必要です：

- **精度の限界**: 自動生成されるルールの精度や関連性にはまだ改善の余地があります。
- **手動での調整**: 生成されたルールは必ず確認し、必要に応じて編集することが推奨されます。
- **頻繁な更新**: この機能は頻繁に更新される可能性があり、使用方法や効果が変わる場合があります。


## SpecStoryのセキュリティ

SpecStoryの使用にあたっては、セキュリティ面も重要な考慮点です。以下ではSpecStoryに関連するセキュリティについて詳細に説明します。

### ローカルストレージのセキュリティ

SpecStoryの最大のセキュリティ上の利点は、データが完全にローカルに保存される点です。これにより以下のようなセキュリティ上の利点があります：

- **クラウド依存の排除**: 会話データがクラウドサービスを介さずに保存されるため、クラウドサービスに起因するセキュリティリスクを避けられます。
- **オフライン環境への対応**: インターネット接続のない環境（エアギャップ環境）でも利用可能です。
- **企業のセキュリティポリシー遵守**: データローカル保存を義務付ける厳格なセキュリティポリシーがある組織でも利用できます。
- **データ主権の確保**: 会話データの保存場所と管理権限を完全に開発者自身がコントロールできます。


### 共有機能使用時のセキュリティ考慮点

share.specstory.com経由で会話履歴を共有する際には、以下のセキュリティ上の考慮が必要です：

- **アクセス制限**: 共有リンクを生成する際には、閲覧者を限定するためのアクセス制限を設定することをお勧めします。
- **機密情報のレビュー**: 共有前に、会話内容に機密情報（APIキー、パスワード、個人情報など）が含まれていないか確認する必要があります。
- **有効期限の設定**: 共有リンクの有効期限を設定し、不要になった時点でアクセスを無効化することで、長期的なセキュリティリスクを低減できます。
- **透過的なデータ処理**: 共有データがどのように処理され、どのくらいの期間保存されるのかを理解してから共有機能を使うべきです。


### バージョン管理と.gitignoreの設定

Git管理する場合には、以下のようなセキュリティプラクティスを検討するべきです：

- **.specstoryの選択的無視**: 機密性の高い会話履歴を含む.specstoryディレクトリ内の特定ファイルは.gitignoreに追加し、リポジトリから除外することができます。
- **プライベートリポジトリの使用**: オープンソースプロジェクトでない場合は、プライベートリポジトリを使用して不要なデータ露出を防止します。
- **コミット前のレビュー**: Git管理に.specstoryディレクトリを含める場合は、コミット前に内容を確認し、機密情報が含まれていないことを確認するプロセスを確立します。


### セキュリティのベストプラクティス

SpecStory使用時に推奨されるセキュリティのベストプラクティスは以下の通りです：

1. **定期的な監査**: .specstoryディレクトリの内容を定期的に監査し、不要な会話履歴や機密情報を含むファイルを削除します。
2. **アクセス制限**: マルチユーザー環境では、.specstoryディレクトリへのアクセス権限を適切に設定します。
3. **セキュアな共有**: 会話履歴を共有する際は、必要最小限の情報だけを含め、機密情報は編集・削除してから共有します。
4. **教育と意識向上**: チームメンバーにAIとの会話でのセキュリティリスクについて教育し、機密情報を含めないよう意識付けを行います。

## SpecStoryの実装の中身

SpecStory拡張機能の内部実装について理解することで、その機能をより効果的に活用できるようになります。

### アーキテクチャと設計原則

SpecStoryは、VSCode拡張APIをベースに構築されていますが、特にCursorエディタに最適化されています。その設計には以下のような原則があります：

- **軽量性**: エディタのパフォーマンスに影響を与えないように、軽量な実装が心がけられています。
- **非同期処理**: 会話データの保存は非同期で行われ、開発者の作業を妨げないよう配慮されています。
- **モジュール性**: 機能ごとにモジュール化されており、将来の機能拡張に対応しやすい設計になっています。


### ファイル保存の仕組み

SpecStoryでは、以下のような仕組みでAIとの会話が保存されます：

1. **イベントリスナー**: Cursorのチャットパネルでの対話イベントをリッスンし、新しい会話が発生したことを検知します。
2. **データの構造化**: 会話データ（質問、回答、メタデータなど）を構造化してメモリに保持します。
3. **ファイル書き込み**: 構造化されたデータをMarkdown形式に変換し、.specstory/historyディレクトリ内に適切なファイル名でファイルを作成します。
4. **インデックス管理**: 検索を容易にするため、会話データのインデックスが内部的に管理されます。

### Markdownフォーマット

保存されるMarkdownファイルのフォーマットは以下のような構造になっています：

```markdown
# [タイトル/最初の質問]

日時: [タイムスタンプ]
セッションID: [ユニークID]

## 質問

[ユーザーからの質問内容]

## 回答

[AIからの回答内容]

...（以降、会話が続く場合は同様のフォーマットで続く）
```

このフォーマットは、人間が読みやすいだけでなく、コードブロックや画像、リンクなどのMarkdown要素をそのまま保持できるように設計されています。

### 共有機能の実装

共有機能は以下のようなプロセスで実装されています：

1. **コマンド検出**: ユーザーがコマンドパレットから共有コマンドを実行すると、共有プロセスが開始されます。
2. **ファイル選択**: 最新の会話が自動的に選択されるか、または特定の会話ファイルを手動で選択します。
3. **データ加工**: 選択されたMarkdownファイルを読み込み、必要に応じて加工します（機密情報の編集など）。
4. **API通信**: share.specstory.comのAPIに処理済みのMarkdownデータを送信します。
5. **共有リンク生成**: APIからの応答として共有リンクを受け取り、ユーザーに表示します。

### ルール自動生成の実装アルゴリズム

実験的なルール自動生成機能の実装は以下のような手法に基づいています：

1. **自然言語処理**: 会話履歴のテキストを自然言語処理技術で分析し、重要なパターンや指示を特定します。
2. **頻度分析**: 繰り返し言及されるコーディングパターンや命名規則などを頻度分析に基づいて抽出します。
3. **コンテキスト認識**: 会話の文脈を理解し、単なるキーワードマッチングを超えた意味的な分析を行います。
4. **ルールフォーマット変換**: 抽出された知見を.cursorrules形式に変換し、Cursor環境で利用可能な形式にフォーマットします。

### パフォーマンス最適化

SpecStoryでは、大量の会話履歴を扱う際でもパフォーマンスが低下しないよう、以下のような最適化が行われています：

- **遅延読み込み**: すべての会話履歴ではなく、必要になったときに読み込みを行う遅延読み込み方式を採用。
- **インクリメンタル処理**: 大量のデータを一度に処理するのではなく、小さな単位で段階的に処理します。
- **キャッシング**: 頻繁にアクセスされるデータをメモリにキャッシュし、ディスクI/Oを最小限に抑えます。
- **圧縮**: 会話履歴が大量になった場合、古いデータを圧縮して保存スペースを節約する機能も実装されています。


## .specstoryディレクトリの保存場所

### 基本的な保存場所

.specstoryディレクトリは、Cursorで開いているプロジェクトのルートディレクトリに作成されます。ディレクトリ構造は以下のようになります：

```
my-project/
├── .specstory/
│   └── history/
│       ├── untitled-1.md
│       └── untitled.md
└── README.md
```


### devcontainer環境での挙動

複数のdevcontainerを使用するモノレポ環境（例：フロントエンドとバックエンドを分離）では、各ディレクトリごとに独立したSpecStoryディレクトリが作成されます。

例えば、以下のような構造の場合：

```
my-project/
├── frontend/
│   └── .devcontainer
├── backend/
│   └── .devcontainer
```

3つの異なるCursorエディタウィンドウで開発を行うと（my-project、frontend、backend）、それぞれのディレクトリに個別の`.specstory`ディレクトリが作成され、別々に管理されます：

```
my-project/
├── frontend/
│   ├── .devcontainer/
│   └── .specstory/
├── backend/
│   ├── .devcontainer/
│   └── .specstory/
└── .specstory/ （my-project全体を開いた場合）
```

この場合、各devcontainerを開く際に、そのコンテナ内のルートディレクトリに`.specstory`ディレクトリが個別に作成され、それぞれのコンテキストに沿った会話履歴が保存されます。これにより、フロントエンド開発とバックエンド開発で異なる会話コンテキストを維持できます。

## .specstoryディレクトリのGit管理

.specstoryディレクトリはGitHubにアップロードしてGitでバージョン管理することが可能です。

### Git管理の利点

- **検索性の向上**: GitHubの検索機能で過去のAI会話を簡単に検索可能
- **完全な履歴追跡**: 特定時点での会話状態を完全に復元できる
- **チーム共有の容易さ**: チームメンバー間でAIとの会話履歴を簡単に共有できる


### 実装方法

1. 通常のGitリポジトリと同様に初期化とリモート設定を行う
2. .specstoryディレクトリを含むプロジェクトファイルをコミット
3. GitHubなどのリモートリポジトリにプッシュ

### プライバシーとセキュリティの考慮事項

- 秘密鍵やパスワードなどの機密情報がAIとの会話に含まれていないか確認する
- 必要に応じてプライベートリポジトリを使用する
- GitHubにアップロードしたくない特定のファイルは.gitignoreに追加する


## インストール方法

SpecStoryをCursorエディタにインストールする手順は以下の通りです：

1. 最新版のCursorがインストールされていることを確認します（Version 0.43.6以降推奨）。
2. 公式サイトからVSIXファイル（specstory-vscode-latest.vsix）をダウンロードします。
※注意: Visual Studio Codeマーケットプレイスからは直接インストールできません。VSCode向けにインストールされてしまい、Cursorでは動作しません。
3. Cursorを起動し、コマンドパレット（Windows/LinuxはCtrl+Shift+P、MacはCmd+Shift+P）を開きます。
4. `Extensions: Install from VSIX…`を選択し、ダウンロードしたVSIXファイルを指定します。
5. インストール完了後、Cursorを再起動します。
6. インストールの確認として、Cursorの拡張機能サイドバーを開き、「SpecStory (Cursor Extension)」が表示されていることを確認します。

インストール後は特別な設定をしなくても、CursorでチャットやComposerを使用した際の履歴が自動的に保存されるようになります。

## 活用シナリオと応用例

### 個人開発での活用

- **知識ベースの構築**: 開発中に遭遇した問題とその解決法をAIと議論し、その会話を後から参照することで、同様の問題に迅速に対処できます。
- **コーディングパターンの記録**: 特定のタスクに対するAIの提案を記録し、類似したタスクに応用することで開発速度を向上させます。
- **学習の加速**: 新しい技術やフレームワークについてAIと対話し、その会話を学習リソースとして活用できます。


### チーム開発での活用

- **知識共有の促進**: AIとの会話履歴をGit管理し、チーム全体で共有することで、個人の知識がチーム全体の資産となります。
- **オンボーディングの効率化**: 新しいチームメンバーに対し、プロジェクトの背景や設計決定の理由が記録されたAI会話を共有することで、スムーズな立ち上がりをサポートします。
- **コードレビューの充実**: コード変更の背景にあるAIとの議論を共有することで、レビュアーがより深く変更の意図を理解できます。


### ドキュメンテーションへの応用

- **実装決定の記録**: 「なぜこの実装方法を選んだのか」をAIとの対話から再構成し、ドキュメントに反映できます。
- **APIドキュメントの作成**: APIの使用方法や設計意図についてAIと対話した内容を、公式ドキュメントの草案として活用できます。
- **トラブルシューティングガイドの作成**: 発生した問題とその解決策についてのAIとの対話を、トラブルシューティングガイドに発展させることができます。


## まとめ

SpecStoryは、Cursor AIエディタの能力を大幅に拡張する革新的な拡張機能です。AIとの会話履歴を自動保存し、検索可能なナレッジベースとして活用できる機能は、個人開発者からチーム開発まで幅広いシナリオで価値を発揮します。

特に注目すべきは、単なる保存機能にとどまらない「共有機能」や「ルール自動生成機能」といった先進的な機能です。これらを活用することで、AIとの対話がより効果的かつ効率的になり、開発プロセス全体の質が向上します。

プロジェクトの構成やdevcontainer環境に応じて適切に.specstoryディレクトリが作成され、必要に応じてGit管理することで、AIとの対話を貴重な資産として活用することが可能になります。セキュリティ面でも適切な配慮がなされており、企業環境でも安心して利用できるツールとなっています。

「あの時のいい提案どこいったっけ？」という悩みから解放され、AIとの効果的な協働を実現するために、SpecStoryの導入を検討してみてはいかがでしょうか。

