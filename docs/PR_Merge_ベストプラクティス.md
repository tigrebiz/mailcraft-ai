# プルリクエスト・マージのベストプラクティス

このドキュメントでは、プルリクエスト（PR）の作成から、レビュー、マージまでの流れと各ステップでのベストプラクティスについてまとめています。

## 目次

1. [プルリクエストの基本](#プルリクエストの基本)
2. [プルリクエストの詳細説明](#プルリクエストの詳細説明)
3. [レビューとコメント](#レビューとコメント)
4. [プルリクエストのクローズとマージ](#プルリクエストのクローズとマージ)
5. [マージ時のコミットメッセージ](#マージ時のコミットメッセージ)
6. [参考例](#参考例)

## プルリクエストの基本

### プルリクエストとは

プルリクエスト（PR）は、ブランチの変更を別のブランチ（通常はメインブランチ）に統合する前に、コードレビューを行うための仕組みです。

### プルリクエストの目的

- コードの品質保証
- 知識共有
- バグの早期発見
- チーム内でのコラボレーション促進

### 基本的な流れ

1. 機能ブランチを作成し開発
2. 変更をコミットしプッシュ
3. プルリクエストを作成
4. レビューとフィードバック
5. 必要に応じて修正
6. 承認後にマージ

## プルリクエストの詳細説明

### 書くべき情報

1. **変更の目的と背景**

   - なぜこの変更が必要だったのか
   - 解決する問題や実現する機能の説明
   - 関連する課題やチケット番号

2. **変更内容の概要**

   - 主要な変更点のリスト（箇条書きが効果的）
   - 技術的なアプローチや選択した実装方法の説明
   - 特に複雑な部分や、注目してほしい箇所の指摘

3. **テスト情報**

   - どのようにテストしたか
   - テスト結果や検証方法
   - 手動確認した内容

4. **その他の考慮事項**
   - 検討した代替案とその採用/不採用の理由
   - 将来的な拡張や改善点
   - 既知の制限事項や今後の課題

### 詳細な説明を書く利点

- レビュアーがコンテキストを理解しやすくなる
- レビュー効率の向上
- 変更の意図が明確になる
- 知識の共有と蓄積につながる
- 後から変更履歴を追跡する際の貴重な情報源となる

## レビューとコメント

### コメントの目的

- コードの問題点や改善点の指摘
- 質問や提案を行い、開発者と議論する場を提供
- 具体的な行にコメントを付けて、詳細な指摘

### コメントへの対応

- レビューコメントには誠実に対応する
- 修正するか、対応しない場合は理由を説明
- コメントが解決したら「Resolve」としてマーク

### 効果的なレビュープロセス

- 単純なスタイル指摘よりもロジックや設計に焦点を当てる
- 肯定的なフィードバックも含める
- 建設的な提案を心がける
- PR の範囲を超える大きな改善案は別イシューとして提案

## プルリクエストのクローズとマージ

### プルリクエストのクローズとは

- クローズ：変更を取り込まずにプルリクエストを終了する操作
- 変更は対象ブランチに取り込まれない
- プルリクエストは「Closed」状態となり、変更は破棄されたとみなされる
- 後から再オープンすることも可能

### クローズする一般的な理由

- 変更が不要になった（要件変更や別アプローチの採用）
- 別のプルリクエストで同様の変更が行われた
- 問題があり、作り直す必要がある
- 実験的なコードで本番環境には適さないと判断された

### マージとは

- マージ：変更を対象ブランチ（通常は main）に取り込む操作
- プルリクエストは自動的に「Merged（マージ済み）」状態となる
- マージはクローズを含む操作（マージ = 変更を取り込む + クローズ）
- マージされたプルリクエストは再オープンできない

## マージ時のコミットメッセージ

### コミットメッセージ（上部欄）

- GitHub が自動生成するデフォルトの「Merge pull request #X from ブランチ名」をそのまま使用するのが一般的
- これにより、どの PR からのマージなのかが自動的に記録される
- 特別な理由がなければ変更する必要はない

### 拡張説明（Extended description）

- PR の主要な変更内容を簡潔に記述する（3〜5 行程度）
- 変更の主な目的
- 特に注意すべき点
- 関連するチケットや Issue 番号

### 効果的な拡張説明の 3 つの原則

1. **簡潔さ** - 要点のみを記載
2. **明確さ** - 何をどう変更したかが一目でわかる
3. **トレーサビリティ** - 関連する Issue/チケット番号を含める

### PR の説明とマージコミットの違い

- **PR 説明** - 詳細で包括的（レビュアー向け）
- **マージコミット説明** - 簡潔で本質的（履歴閲覧者向け）

## 参考例

### 良い PR 説明の例

```
## 概要
admin_usersテーブルにname（氏名）とfurigana（ふりがな）カラムを追加

## 目的と背景
- 管理者ユーザーの氏名情報が保存できず、システム内での識別が困難だった
- 氏名で検索・ソートする機能実装のため、これらのカラムが必要

## 変更内容
- admin_usersテーブルに以下のカラムを追加:
  - name: TEXT NOT NULL - 管理者ユーザーの氏名
  - furigana: TEXT NOT NULL - 氏名のふりがな（検索・ソート用）
- DB設計書の関連箇所（カラム説明、SQL、Django ORM定義）を更新

## 検討事項
- furiganaカラムにインデックスの追加も検討したが、データ量を考慮して当面は不要と判断
- 将来的にユーザー数が増加した場合は、インデックス追加を検討する

## 確認方法
- migrationsファイルが正しく生成されることを確認済み
- テスト環境でのテーブル作成とデータ操作を確認
```

### ベストなマージ時の拡張説明例

```
admin_usersテーブルにname、furiganaカラムを追加

目的：管理者ユーザーの表示名と検索機能の実装
影響：マイグレーション実行が必要
関連：Issue #XX
```

---

このドキュメントは継続的に更新され、チームの経験からのベストプラクティスが反映されます。
